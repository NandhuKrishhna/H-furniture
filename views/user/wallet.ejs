<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <%- include("../partials/userSidenav.ejs") %>
    
    <div class="col-md-5 offset-md-1 mt-5"> 
      <div class="card wallet-card"> 
        <div class="card-body text-center">
          <h4>My Wallet</h4>
        <p class="display-4"><%= wallet.balance %> </p>
        <p class="font-weight-bold">Available Balance</p>
          <!-- Stylish Input Field -->
          <div class="input-group mb-3 stylish-input-group">
            <input type="number" id="amount" class="form-control" placeholder="Enter amount" aria-label="Amount" aria-describedby="addMoney" min="1">
            <div class="input-group-append">
              <button id="addMoney" class="btn btn-dark" style="border-radius: 0;">Add Money</button>
            </div>
          </div>
          
        </div>
      </div>
    </div>
    
  </div>
</div>

<style>


.wallet-card {
    box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2); 
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; 
}

.wallet-card:hover {
    transform: translateY(-5px); 
    box-shadow: 0px 6px 20px rgba(0, 0, 0, 0.3); 
}


.stylish-input-group .form-control {
    border-right: none; 
    border-radius: 0; 
}

.stylish-input-group .input-group-append .btn {
    border-radius: 0; 
    background-color: #343a40;
    color: #fff; 
}

.stylish-input-group .form-control:focus {
    box-shadow: none;
    border-color: #343a40; 
}

</style>

<script>
  document.getElementById("addMoney").onclick = async function(e) {
    e.preventDefault();
  
    const amount = document.getElementById("amount").value;
    if(!amount || amount <= 0){
     Swal.fire({
      icon: 'error',
      title: 'Oops...',
      text: 'Please enter a valid amount',
      confirmButtonText: 'OK'
     });
     return;
    }
     
    try {
      const response = await fetch("/user/wallet", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ amount })
      });
  
      const result = await response.json();
      if (result.success) {
        const options = {
          key: "<%= process.env.RAZORPAY_KEY_ID %>",
          amount: amount * 100,
          currency: 'INR',
          name: 'Mazen Furniture',
          description: 'Add Money to Wallet',
          order_id: result.orderId,
          handler: function(response) {
            Swal.fire({
              icon: 'success',
              title: 'Success',
              text: 'Money added to the wallet successfully',
              confirmButtonText: 'OK'
            }).then(() => {
             
              location.reload();
            });
          },
          prefill: {
            name: 'Mazen furniture',
            email: 'mazenfurniture.com',
            contact: '9074101528'
          }
        };
        const rzp1 = new Razorpay(options);
        rzp1.open();
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Oops...',
          text: result.message,
          confirmButtonText: 'OK'
        });
      }
    } catch (error) {
      console.log("Error from adding money to the wallet:", error);
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: 'An error occurred while adding money to the wallet',
        confirmButtonText: 'OK'
      });
    }
  };

  </script>
  