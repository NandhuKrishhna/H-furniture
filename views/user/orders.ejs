<style>
.side-menu {
  background-color: #f8f9fa;
  padding: 20px;
  height: 100%;
}

.logout-btn {
  width: 100%;
  margin-top: 20px;
}

.order-card {
  border: 1px solid #ccc;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
  width: 60%;
}

.order-card h5, .order-card p {
  margin: 0;
  padding: 0;
}

.order-card .card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: none;
  border-bottom: none;
}

.order-card .card-header .badge {
  background-color: #000;
  color: #fff;
}

.side-menu {
  padding-top: 20px;
}

.alert-danger {
  background: none;
  border: none;
  color: red;
  font-weight: 600;
}

.order-item {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
  border-bottom: 1px solid #e0e0e0;
  padding-bottom: 10px;
}

.product-image {
  max-width: 100px;
  max-height: 100px;
  margin-right: 15px;
  border-radius: 5px;
}

.product-details {
  flex: 1;
}

.product-price {
  text-align: right;
  margin-left: 15px;
}

.discount-price {
  color: red;
}

.order-total {
  margin-top: 20px;
  font-weight: bold;
}
.cancel-order-btn{

    right: 45%;
    top: 28%;
}
.order-card{
  margin-left: 40px;
}
</style>

<%- include("../partials/userSidenav.ejs") %>
<div class="col-md-9 order-body">
 <h3>Your Orders</h3>
 <% orders.forEach(order => { %>
  <div class="order-card">
    <div class="card-header">
      <h6>Order No: <%= order.transactionId %></h6>
      <span class="order-date">Ordered: <%= new Date(order.orderDate).toLocaleDateString() %></span>
    </div>
    <ul class="order-items-list">
      <% order.orderItems.forEach(item => { %>
        <li class="order-item">
          <img src="/<%= item.image %>" alt="<%= item.name %>" class="product-image">
          <div class="product-details">
            <div><strong><%= item.name || 'Unknown Product' %></strong></div>
            <div>Qty: <%= item.quantity || 0 %></div>
            <div>Price: ₹<%= item.price.toFixed(2) %></div>
            <% if (item.status !== 'Cancelled') { %>
              <button class="cancel-order-btn btn-dark" data-order-id="<%= order._id %>" data-item-id="<%= item._id %>">Cancel</button>
              <% } %>
          </div>
        </li>
      <% }) %>
    </ul>
    <div class="order-total">
      <div>Status: <%= order.orderStatus %></div>
      <div>Order Total: ₹<%= order.totalAmount.toFixed(2) %></div>
    </div>
  </div>
<% }) %>

</div>




<script>
$(document).ready(function() {
  $('.cancel-order-btn').click(function() {
    const orderId = $(this).data('order-id');
    const itemId = $(this).data('item-id'); 
    console.log('Order ID:', orderId);
    console.log('Item ID:', itemId);

    if (!orderId || !itemId) {
      Swal.fire({
        icon: 'error',
        title: 'Invalid IDs',
        text: 'Order ID or Item ID is missing. Please try again.',
      });
      return;
    }

    Swal.fire({
      title: 'Are you sure?',
      text: "Do you really want to cancel this item?",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, cancel it!'
    }).then((result) => {
      if (result.isConfirmed) {
        $.ajax({
          url: `/order/${orderId}/item/${itemId}/cancel`,
          type: 'POST',
          success: function(response) {
            if (response.success) {
              Swal.fire({
                icon: 'success',
                title: 'Cancelled',
                text: response.message,
              }).then(() => {
                location.reload(); 
              });
            } else {
              Swal.fire({
                icon: 'error',
                title: 'Error',
                text: response.message,
              });
            }
          },
          error: function(error) {
            console.error(error);
            Swal.fire({
              icon: 'error',
              title: 'An error occurred',
              text: 'An error occurred while cancelling the item. Please try again.',
            });
          }
        });
      }
    });
  });
});


</script>


