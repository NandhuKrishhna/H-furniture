<style>
  .input-number {
    display: inline-block;
    background-color: #ffffff;
    border: 1px solid #d1d5db;
    padding: 0.5rem;
  }

  .input-number .input-group {
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  .input-number button {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    border: 0px solid #d1d5db;
    background-color: #ffffff;
    color: #4b5563;
    padding: 0.375rem 0.75rem;
    cursor: pointer;
    transition: background-color 0.2s ease, opacity 0.2s ease;
  }

  .input-number button:hover {
    background-color: #ffffff;
  }

  .input-number button:disabled {
    opacity: 0.5;
    pointer-events: none;
  }

  .input-number input {
    padding: 0;
    width: 2rem;
    background-color: transparent;
    border: 0;
    text-align: center;
    color: #4b5563;
  }

  .accordion .card-header {
    border: none;
    padding: 0.75rem 1.25rem;
    background: none;
  }

  .accordion .card {
    border: none;
  }

  .accordion .btn-link {
    width: 100%;
    text-align: left;
    font-size: 1.25rem;
    font-weight: 500;
    display: flex;
    justify-content: space-between;
    color: #000;
    text-decoration: none;
    padding: 0;
  }

  .accordion .btn-link:hover,
  .accordion .btn-link:focus {
    text-decoration: none;
    outline: none;
    box-shadow: none;
  }

  .accordion .card-body {
    padding: 0.75rem 1.25rem;
  }

  .accordion .plus-icon::after {
    content: '+';
    font-size: 1.5rem;
    font-weight: bold;
  }

  .accordion .btn-link[aria-expanded="true"] .plus-icon::after {
    content: '-';
  }

  .accordion .card + .card {
    border-top: 1px solid #dee2e6;
  }
  /* Adjust the size of the SweetAlert2 popup */
.custom-swal-popup {
  width: 400px; /* Set the width of the alert dialog */
  max-width: 90%; /* Ensure it doesn't exceed the viewport width */
  padding: 20px; /* Add padding inside the alert */
}

/* Customize the title font size */
.custom-swal-title {
  font-size: 24px; /* Set the font size for the title */
}

/* Customize the content font size */
.custom-swal-content {
  font-size: 16px; /* Set the font size for the content */
}

/* Customize the confirm button appearance */
.custom-swal-confirm-button {
  background-color: #272727; /* Button background color */
  color: #fff; /* Button text color */
  border-radius: 5px; /* Round the corners of the button */
  padding: 10px 20px; /* Adjust padding for the button */
}

/* Optional: Adjust the position of the button */
.custom-swal-confirm-button {
  margin-top: 20px; 
}

/* Button hover state */
.custom-swal-confirm-button:hover {
  background-color: #000000; 
}

/* Button active state */
.custom-swal-confirm-button:active {
  background-color: #363636; 
}
 
</style>
<div class="container mt-5">
    <div class="row">
      <!-- Image Gallery -->
      <div class="col-md-6">
        <div class="row">
          <div class="col-12 mb-2">
            <img src="/<%= product.images[0] %>" class="img-fluid" alt="Main Product Image" style="min-width: 80%; height: auto;">
          </div>
          <% for (let i = 1; i < product.images.length && i < 3; i++) { %>
          <div class="col-4 mb-2">
            <img src="/<%= product.images[i] %>" class="img-fluid" alt="Product Image <%= i %>" style="min-width: 110%; height: auto;">
          </div>
          <% } %>
        </div>
      </div>
      <!-- Product Details -->
      <div class="col-md-6">
        <h3><%= product.productName %></h3>
        <% if (product.discount) { %>
          <p class="card-text text-muted">
            <span style="text-decoration: line-through;">₹<%= product.originalprice %></span>
            <span id="discountedPrice" style="font-weight: 700; font-size: 20px; color:black">₹<%= calculateDiscountedPrice(product.originalprice, product.discount) %></span>
          </p>
          <p style="color: chocolate; font-weight: 700"><%= product.discount %>% off</p>
        <% } %>
        <span style="background-color: black; color: white; padding: 5px 10px;">Price inclusive of all taxes | Free shipping</span>
    
        <!-- Customization Options -->
        <div class="customize mt-4">
          <h6>Customize</h6>
          <p>Note: Additional charges are applicable for the following services and products.*</p>
          <p><span class="badge badge-dark bg-dark">Ready to Ship</span></p>
        </div>
    
        <!-- Quantity Selector -->
        <div class="quantity mt-4">
          <h6>Quantity</h6>
          <div class="input-number">
            <div class="input-group">
              <button type="button" class="decrement-btn" onclick="decrementValue()">-</button>
              <input type="text" value="1" id="numberInput">
              <button type="button" class="increment-btn" onclick="incrementValue()">+</button>
            </div>
          </div>
        </div>
    
        <!-- Price and Add to Cart -->
        <div class="price-and-cart mt-4">
          <h6>Price</h6>
          <div style="display: flex; align-items: center;">
            <span id="totalPrice" style="font-weight: 700; font-size: 20px; color:black">₹<%= calculateDiscountedPrice(product.originalprice, product.discount) %></span>
            <button class="btn btn-dark ml-3">Add To Cart</button>
            <% if (length > 0 && length <= 11) { %>
              &nbsp;&nbsp;&nbsp;&nbsp;<h5 style="color: red; font-weight: bold;">Only <%= length %> stock left</h5>
            <% } %>
            <% if (length<1) { %>
              &nbsp;&nbsp;&nbsp;&nbsp;<h5 style="color: red; font-weight: bold;">Out of Stock</h5>
            <% } %>
        </div>
    
        <!-- Additional Info -->
        <div class="additional-info mt-4">
          <p><i class="fa-regular fa-calendar"></i>&nbsp;&nbsp;&nbsp;&nbsp;<strong>Expected Dispatch Date:</strong> <span id="dispatch-date"></span></p>
          <p style="display: flex; align-items: center; gap: 5px;">
            <i class="fa-solid fa-house"></i>&nbsp;
            <a href="#" style="color: #4b5563; font-size: 14px; text-decoration: underline 1px solid currentColor; text-underline-offset: 4px;">
              Free Design Consultation
            </a>
          </p>
          <p style="display: flex; align-items: center; gap: 5px;">
            <i class="fa-solid fa-truck"></i>&nbsp;
            <a href="#" style="color: #4b5563; font-size: 14px; text-decoration: underline 1px solid currentColor; text-underline-offset: 4px;">
              Pan India Free Shipping
            </a>
          </p>
        </div>
    </div>
    
        <!-- Share Icons -->
        <div class="share mt-4">
          <p>Share: 
            <i class="fa-brands fa-facebook-f"></i>
            &nbsp;
            <i class="fa-brands fa-whatsapp"></i>
            &nbsp;
            <i class="fa-brands fa-twitter"></i>
          </p>
        </div>
      </div>
    </div>
  
    <div class="row mt-5">
      <div class="col-12">
        <div class="accordion" id="productInfoAccordion">
          <div class="card">
            <div class="card-header" id="headingOne">
              <h5 class="mb-0">
                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                  Description <span class="plus-icon"></span>
                </button>
              </h5>
            </div>
            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#productInfoAccordion">
              <div class="card-body">
                <%= product.description %>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="headingTwo">
              <h5 class="mb-0">
                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                  Key Features <span class="plus-icon"></span>
                </button>
              </h5>
            </div>
            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#productInfoAccordion">
              <div class="card-body">
                <p>Primary Material: <%= product.primarymaterial %></p>
                <p>Country of Origin: <%= product.countryofOrigin %></p>
                <p>Floor Standing: <%= product.floorstanding %></p>
                <p>Secondary Material: <%= product.material %></p>
                <p>Fabric Option: <%= product.fabric_option %></p>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="headingThree">
              <h5 class="mb-0">
                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                  Dimension <span class="plus-icon"></span>
                </button>
              </h5>
            </div>
            <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#productInfoAccordion">
              <div class="card-body">
                <%= product.dimension %>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="headingFour">
              <h5 class="mb-0">
                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                  Maintenance <span class="plus-icon"></span>
                </button>
              </h5>
            </div>
            <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#productInfoAccordion">
              <div class="card-body">
                Maintenance instructions.
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="headingFive">
              <h5 class="mb-0">
                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                  Warranty summary <span class="plus-icon"></span>
                </button>
              </h5>
            </div>
            <div id="collapseFive" class="collapse" aria-labelledby="headingFive" data-parent="#productInfoAccordion">
              <div class="card-body">
                Warranty: <%= product.warranty %>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="headingSix">
              <h5 class="mb-0">
                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                  Return Policy <span class="plus-icon"></span>
                </button>
              </h5>
            </div>
            <div id="collapseSix" class="collapse" aria-labelledby="headingSix" data-parent="#productInfoAccordion">
              <div class="card-body">
                Return policy details.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
 
  
<script>
const originalPrice = '<%= calculateDiscountedPrice(product.originalprice, product.discount) %>';
const numberInput = document.getElementById('numberInput');
const totalPriceElement = document.getElementById('totalPrice');
const addToCartButton = document.querySelector('.btn-dark'); // Button selector
const productId = "<%= product._id %>"; // Product ID from EJS template
console.log("The product id is " + productId);
const productPrice = '<%= product.price %>'; // Product price from EJS template

function addToCart() {
  console.log('Add to Cart button clicked');
  const quantity = parseInt(numberInput.value, 10);
  console.log('Quantity:', quantity);

  // Validate quantity
  if (isNaN(quantity) || quantity <= 0) {
    alert('Please enter a valid quantity.');
    return;
  }


  fetch(`/user/cart/${productId}`, {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ quantity: quantity, price: productPrice })
})
.then(response => {
  console.log('Response status:', response.status);
  return response.json().then(data => ({ status: response.status, data }));
})
.then(({ status, data }) => {
  console.log('Response data:', data);

  if (status === 200) {
    // Use SweetAlert2 for success message
    Swal.fire({
      icon: 'success',
      title: 'Success!',
      text: data.message || 'Product added to cart successfully!',
      customClass: {
    container: 'custom-swal-container',
    popup: 'custom-swal-popup',
    title: 'custom-swal-title',
    content: 'custom-swal-content',
    confirmButton: 'custom-swal-confirm-button'
  }
    });
  } else if (status === 400 && data.message === 'Product is out of stock') {
    
    Swal.fire({
      icon: 'warning',
      title: 'Out of Stock',
      text: 'The product you are trying to add is out of stock.',
      customClass: {
    container: 'custom-swal-container',
    popup: 'custom-swal-popup',
    title: 'custom-swal-title',
    content: 'custom-swal-content',
    confirmButton: 'custom-swal-confirm-button'
  }
    });
  } else {
    // Use SweetAlert2 for other errors
    Swal.fire({
      icon: 'error',
      title: 'Error!',
      text: data.message || 'Failed to add product to cart. Please try again.',
      customClass: {
    container: 'custom-swal-container',
    popup: 'custom-swal-popup',
    title: 'custom-swal-title',
    content: 'custom-swal-content',
    confirmButton: 'custom-swal-confirm-button'
  }
    });
  }
})
.catch(error => {
  console.error('Error:', error);
  // Use SweetAlert2 for general error message
  Swal.fire({
    icon: 'error',
    title: 'Oops...',
    text: 'An unexpected error occurred. Please try again later.',
    customClass: {
    container: 'custom-swal-container',
    popup: 'custom-swal-popup',
    title: 'custom-swal-title',
    content: 'custom-swal-content',
    confirmButton: 'custom-swal-confirm-button'
  }
  });
});


}

// Event listener for the Add to Cart button
if (addToCartButton) {
  addToCartButton.addEventListener('click', addToCart);
} else {
  console.error('Add to Cart button not found');
}

function updatePrice() {
  const quantity = parseInt(numberInput.value, 10);
  const newPrice = originalPrice * quantity;
  totalPriceElement.textContent = `₹${newPrice.toLocaleString()}`;
}

function incrementValue() {
  let value = parseInt(numberInput.value, 10);
  value = isNaN(value) ? 0 : value;
  value++;
  numberInput.value = value;
  updatePrice();
}

function decrementValue() {
  let value = parseInt(numberInput.value, 10);
  value = isNaN(value) ? 0 : value;
  value = value > 1 ? value - 1 : 1;
  numberInput.value = value;
  updatePrice();
}

// Initialize the price display
updatePrice();

function setExpectedDispatchDate() {
  let today = new Date();
  today.setDate(today.getDate() + 15);
  let options = { year: 'numeric', month: 'short', day: '2-digit' };
  let formattedDate = today.toLocaleDateString('en-US', options);
  document.getElementById('dispatch-date').innerText = formattedDate;
}

document.addEventListener('DOMContentLoaded', setExpectedDispatchDate);


</script>
